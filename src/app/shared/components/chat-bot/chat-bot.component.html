<div class="chat-bot-container" [class.open]="isOpen" [class.minimized]="isMinimized">
  <!-- Chat Toggle Button -->
  <button class="chat-toggle" (click)="toggleChat()" [class.has-notification]="unreadCount > 0">
    <div class="toggle-icon">
      <i class="fas" [class.fa-times]="isOpen" [class.fa-comments]="!isOpen"></i>
    </div>
    <div class="notification-badge" *ngIf="unreadCount > 0">{{ unreadCount }}</div>
    <div class="pulse-ring" *ngIf="unreadCount > 0"></div>
  </button>

  <!-- Chat Window -->
  <div class="chat-window" [@slideIn]>
    <!-- Chat Header -->
    <div class="chat-header">
      <div class="assistant-info">
        <div class="assistant-avatar">ðŸ¤–</div>
        <div class="assistant-details">
          <h3>Alex - TraintiQ Assistant</h3>
          <span class="status" [class.typing]="isTyping">
            {{ isTyping ? 'Typing...' : 'Online' }}
          </span>
        </div>
      </div>
      <div class="header-actions">
        <button class="header-btn" (click)="minimizeChat()" matTooltip="Minimize">
          <i class="fas fa-minus"></i>
        </button>
        <button class="header-btn" (click)="closeChat()" matTooltip="Close">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>

    <!-- Chat Messages -->
    <div class="chat-messages" #messagesContainer>
      <div *ngFor="let message of messages; trackBy: trackByMessageId" 
           class="message-wrapper" 
           [class.bot]="message.isBot"
           [class.user]="!message.isBot"
           [@messageSlide]>
        
        <div class="message" [class.bot]="message.isBot" [class.user]="!message.isBot">
          <div class="message-avatar" *ngIf="message.isBot">
            {{ message.avatar || 'ðŸ¤–' }}
          </div>
          
          <div class="message-content">
            <div class="message-bubble">
              <p [innerHTML]="formatMessageText(message.text)"></p>
            </div>
            <small class="timestamp">{{ message.timestamp | date:'shortTime' }}</small>
          </div>
        </div>

        <!-- Quick Replies -->
        <div class="quick-replies" *ngIf="message.quickReplies && message.quickReplies.length > 0">
          <button *ngFor="let reply of message.quickReplies" 
                  class="quick-reply-btn"
                  (click)="sendQuickReply(reply)"
                  [@fadeInUp]="reply">
            {{ reply }}
          </button>
        </div>
      </div>

      <!-- Typing Indicator -->
      <div class="message-wrapper bot typing-indicator" *ngIf="isTyping" [@fadeIn]>
        <div class="message bot">
          <div class="message-avatar">ðŸ¤–</div>
          <div class="message-content">
            <div class="message-bubble typing">
              <div class="typing-dots">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Chat Input -->
    <div class="chat-input">
      <div class="input-container">
        <input type="text" 
               [(ngModel)]="currentMessage" 
               (keyup.enter)="sendMessage()"
               placeholder="Type your message..."
               [disabled]="isTyping"
               class="message-input">
        <button (click)="sendMessage()" 
                [disabled]="!currentMessage.trim() || isTyping"
                class="send-button">
          <i class="fas" [class.fa-paper-plane]="!isTyping" [class.fa-spinner]="isTyping" [class.fa-spin]="isTyping"></i>
        </button>
      </div>
      <div class="powered-by">
        Powered by TraintiQ AI
      </div>
    </div>
  </div>
</div> 